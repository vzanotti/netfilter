\section<presentation>[Principes et risques]{Les principes et les risques du filtrage}
  \begin{frame}
    \frametitle{Contexte: un filtre transparent}
    \begin{itemize}
      \item<1-> Filtrer du traffic (web) sans toucher aux connexions TCP.\\
        \only<1>{
          \begin{figure}[h]
            \includegraphics[width=0.8\textwidth]{pictures/filter-before.png}
          \end{figure}
        }
        \only<2->{
          \begin{figure}[h]
            \includegraphics[width=0.8\textwidth]{pictures/filter-after.png}
          \end{figure}
        }
      \item<3-> Cas d'école: appliquer des règles de QoS restrictives sur les fichiers {\tt .pdf}.
      \item<4-> Hypothèse: l'un des coté est neutre (pas de complicité).
    \end{itemize}
  \end{frame}

  \begin{frame}[t]
    \frametitle{Fonctionnement d'un filtre applicatif}
    Fonctionnement d'un filtre transparent au niveau 7 (OSI):
    \begin{itemize}
      \item<1-> Identification et groupage des packets par session TCP.\\
        \only<1>{\tt\scriptsize
          <tcp src=129.104.201.51 dst=87.98.164.72 sport=4242 dport=80> et \\
          <tcp src=87.98.164.72 dst=129.104.201.51 sport=80 dport=4242>
        }
      \item<2-> Extraction du contenu des buffers egress/ingress.\\
        \only<2>{\tt\scriptsize
          > GET /abcd.pdf HTTP/1.0\\
          > Host: www.blih.org\\
          > \\
          < HTTP/1.1 200 OK\\
          \dots
        }
      \item<3-> Détection du protocole utilisé.
      \item<4-> Extraction des information (protocol buffer).\\
        \only<4>{\tt\scriptsize
          proto=HTTP, method=GET, url=/abcd.pdf
        }
      \item<5-> Classification finale.\\
        \only<5>{
          Exemple de règle: {\tt\scriptsize proto=HTTP method=GET url=.*$\backslash$.pdf}
        }
    \end{itemize}
  \end{frame}

  \begin{frame}
    \frametitle{Attaques et contournement d'un filtre applicatif}
    \begin{itemize}
      \item Contournement via les couches 3/4 OSI.
        \begin{itemize}
          \item Fragmentation des paquets au niveau IP.
          \item Ré-arrangement des paquets TCP.
        \end{itemize}
      \item Contournement via l'implémentation du protocole
        \begin{itemize}
          \item Contournement par exploitation du protocole
          \item Contournement par leurre du détecteur de protocole
          \item Contournement par non-respect du protocole
        \end{itemize}
      \item Attaque \emph{Denial of Service} classique
    \end{itemize}
  \end{frame}

  \begin{frame}
    \frametitle{Contournement par fragmentation des paquets}
    Idée: casser ``l'atomicité'' des échanges avec des petits paquets.
    \begin{itemize}
      \item<1-> Le protocole http est un protocole \emph{human readable}.
      \item<2-> Une requête http normale passe dans un paquet TCP.\\
        {\small C'est à dire que {\tt sizeof(requete + headers) <= max payload size}}
      \item<3-> Implémentation naïve: filtrage par paquets.
      \item<4-> Attaque:\\
        {\scriptsize
          Original: {\tt "GET /abcd.pdf HTTP/1.0"}\\
          Modifié:  {\tt "GE" "T /abcd.pdf HTT" "P/1.0"}
        }
      \item<5-> Défense: utilisation de buffers egress/ingress pour la session TCP.
    \end{itemize}
  \end{frame}

  \begin{frame}
    \frametitle{Contournement par \emph{reordering} des paquets TCP}
    Idée: réordonner les paquets TCP pour tromper le filtre.
    \begin{itemize}
      \item<1-> Support du réarrangement de paquets dans TCP.
      \item<2-> Normalement:\\
        {\tt\scriptsize
          > pkt=1, payload="GET /abcd.pdf HTTP/1.0"
        }
      \item<3-> Après fragmentation:\\
        {\tt\scriptsize
          > pkt=1, payload="GE"\\
          > pkt=2, payload="T /abcd.pdf HTT"\\
          > pkt=3, payload="P/1.0"
        }
      \item<4-> Après re-arrangement:\\
        {\tt\scriptsize
          > pkt=1, payload="GE"\\
          > pkt=3, payload="P/1.0"\\
          > pkt=2, payload="T /abcd.pdf HTT"
        }
      \item<5-> Défense: rearrangement manuel, complexe, coûteux.
    \end{itemize}
  \end{frame}

  \begin{frame}[t]
    \frametitle{Contournement par exploitation du protocole}
    Idée: exploiter des fonctionnalités obscures (ou pas) du protocole.
    % Keepalive
  \end{frame}

  \begin{frame}[t]
    \frametitle{Contournement par leurre du détecteur de protocole}
    Idée: comettre des erreurs récupérables de nature à leurrer le détecteur.
    % Commencer par une erreur en SMTP pour éviter le EHLO.
    % Utiliser des lignes de requete extremement longues, type /././././.....
  \end{frame}

  \begin{frame}[t]
    \frametitle{Contournement par non-respect du protocole}
    Idée: utiliser des \emph{flavor} peu-connues ou des tolérances du protocole.
    % Par exemple utiliser "GET <url>\n"
  \end{frame}

  \begin{frame}[t]
    \frametitle{Attaque \emph{Denial of Service} classique}
    Idée: exploiter les implémentations naïves du protocole.
  \end{frame}
